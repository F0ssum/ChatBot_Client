<Window x:Class="ChatBotClient.Features.Main.Views.Main"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="EmotionAid" Height="600" Width="1000"
        Background="{StaticResource BackgroundBrush}"
        WindowStyle="SingleBorderWindow" AllowsTransparency="False"
        WindowStartupLocation="CenterScreen"
        UseLayoutRounding="True" SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display">

    <Grid>
        <Border Style="{StaticResource BaseBorderStyle}" Margin="10" Effect="{StaticResource DropShadowEffect}">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Верхняя панель: Кнопки управления и очки -->
                <Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="{materialDesign:PackIcon Kind=WindowMinimize}" 
                                Style="{StaticResource WindowControlButtonStyle}" 
                                Command="{Binding MinimizeCommand}"/>
                        <Button Content="{materialDesign:PackIcon Kind=WindowMaximize}" 
                                Style="{StaticResource WindowControlButtonStyle}" 
                                Command="{Binding MaximizeRestoreCommand}" x:Name="MaximizeButton"/>
                        <Button Content="{materialDesign:PackIcon Kind=Close}" 
                                Style="{StaticResource WindowControlButtonStyle}" 
                                Command="{Binding CloseCommand}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding TotalPoints, StringFormat='Очки: {0}'}" 
                               Style="{StaticResource BaseTextStyle}" FontSize="14" 
                               HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0"/>
                </Grid>

                <!-- Кнопка вызова навигационного меню -->
                <Button Content="{materialDesign:PackIcon Kind=Menu}" 
                        Style="{StaticResource MenuButtonStyle}" 
                        Grid.Row="1" Margin="10" HorizontalAlignment="Left"
                        Command="{Binding ToggleNavMenuCommand}"/>

                <!-- Frame для страниц -->
                <Frame x:Name="MainFrame" Grid.Row="2" NavigationUIVisibility="Hidden"/>

                <!-- Панель уведомлений -->
                <Border Grid.Row="3" Style="{StaticResource BaseBorderStyle}" Margin="0,10,0,0" 
                        Visibility="{Binding HasNotifications, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Effect="{StaticResource DropShadowEffect}">
                    <ListBox ItemsSource="{Binding Notifications}" MaxHeight="100" Margin="10" Style="{StaticResource ListBoxStyle}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Style="{StaticResource BaseTextStyle}" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </Grid>
        </Border>

        <!-- Всплывающее навигационное меню -->
        <Border x:Name="NavMenu" Background="{StaticResource ModalOverlayBrush}" 
                Visibility="{Binding IsNavMenuVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Style="{StaticResource BaseBorderStyle}" Width="200" Height="300" 
                    VerticalAlignment="Top" HorizontalAlignment="Left" Margin="50,50,0,0"
                    Effect="{StaticResource DropShadowEffect}">
                <StackPanel Orientation="Vertical" Margin="10">
                    <Button Content="Чат" Style="{StaticResource CircularNavButtonStyle}" 
                            Tag="{materialDesign:PackIcon Kind=Chat}"
                            Command="{Binding NavigateToChatCommand}" Margin="0,5"/>
                    <Button Content="Дневник" Style="{StaticResource CircularNavButtonStyle}" 
                            Tag="{materialDesign:PackIcon Kind=Book}"
                            Command="{Binding NavigateToDiaryCommand}" Margin="0,5"/>
                    <Button Content="Дерево заботы" Style="{StaticResource CircularNavButtonStyle}" 
                            Tag="{materialDesign:PackIcon Kind=Tree}"
                            Command="{Binding NavigateToTreeCommand}" Margin="0,5"/>
                    <Button Content="Настройки" Style="{StaticResource CircularNavButtonStyle}" 
                            Tag="{materialDesign:PackIcon Kind=Settings}"
                            Command="{Binding NavigateToSettingsCommand}" Margin="0,5"/>
                </StackPanel>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"
                                                 EasingFunction="{StaticResource MaterialDesignEasingFunction}"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" 
                                                 From="0" To="1" Duration="0:0:0.3"
                                                 EasingFunction="{StaticResource MaterialDesignEasingFunction}"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                                                 From="0" To="1" Duration="0:0:0.3"
                                                 EasingFunction="{StaticResource MaterialDesignEasingFunction}"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Border.RenderTransform>
                    <ScaleTransform CenterX="100" CenterY="150"/>
                </Border.RenderTransform>
            </Border>
        </Border>

        <!-- Модальное окно приветствия -->
        <Border Background="{StaticResource ModalOverlayBrush}" 
                Visibility="{Binding IsWelcomeModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Style="{StaticResource BaseBorderStyle}" Width="400" Height="300" 
                    VerticalAlignment="Center" HorizontalAlignment="Center"
                    Effect="{StaticResource DropShadowEffect}">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Заголовок -->
                    <TextBlock Text="Приветствую, смотрю ты у нас новенький!" 
                               Style="{StaticResource BaseTextStyle}" FontSize="16" 
                               TextWrapping="Wrap" HorizontalAlignment="Center" Margin="0,0,0,10"/>

                    <!-- Поля ввода -->
                    <StackPanel Grid.Row="1" Margin="0,10,0,0">
                        <TextBox materialDesign:HintAssist.Hint="Имя пользователя" 
                                 Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource ModernTextBoxStyle}" 
                                 Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Content="Загрузить аватар" 
                                    Style="{StaticResource ModernButtonStyle}" 
                                    Command="{Binding SelectAvatarCommand}" Margin="0,0,10,0"/>
                            <Image Source="{Binding AvatarPath}" Width="50" Height="50" 
                                   Visibility="{Binding AvatarPath, Converter={StaticResource NullToVisibilityConverter}}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Кнопки -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                        <Button Content="Сохранить" 
                                Style="{StaticResource ModernButtonStyle}" 
                                Command="{Binding SaveWelcomeCommand}" Margin="0,0,10,0"/>
                        <Button Content="Отмена" 
                                Style="{StaticResource ModernButtonStyle}" 
                                Command="{Binding CancelWelcomeCommand}"/>
                    </StackPanel>
                </Grid>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"
                                                 EasingFunction="{StaticResource MaterialDesignEasingFunction}"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" 
                                                 From="0" To="1" Duration="0:0:0.3"
                                                 EasingFunction="{StaticResource MaterialDesignEasingFunction}"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                                                 From="0" To="1" Duration="0:0:0.3"
                                                 EasingFunction="{StaticResource MaterialDesignEasingFunction}"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Border.RenderTransform>
                    <ScaleTransform CenterX="200" CenterY="150"/>
                </Border.RenderTransform>
            </Border>
        </Border>
    </Grid>
</Window>