<Page x:Class="ChatBotClient.Features.Settings.Views.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      mc:Ignorable="d"
      Background="{StaticResource BackgroundBrush}"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display">
    <Grid>
        <Border CornerRadius="20" Background="{StaticResource BackgroundBrush}" Margin="20"
                Effect="{StaticResource DropShadowEffect}">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="Настройки" FontSize="18" FontWeight="SemiBold" Style="{StaticResource BaseTextStyle}"
                           Margin="0,0,0,10"/>
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Border Background="{StaticResource PaperHoverBrush}" CornerRadius="10" Padding="10"
                            Effect="{StaticResource DropShadowEffect}">
                        <StackPanel>
                            <RadioButton Content="Чат" Style="{StaticResource TabStyle}" IsChecked="{Binding IsChatTabSelected}"
                                         GroupName="SettingsTabs"/>
                            <RadioButton Content="Дневник" Style="{StaticResource TabStyle}" IsChecked="{Binding IsDiaryTabSelected}"
                                         GroupName="SettingsTabs"/>
                            <RadioButton Content="Профиль" Style="{StaticResource TabStyle}" IsChecked="{Binding IsProfileTabSelected}"
                                         GroupName="SettingsTabs"/>
                            <RadioButton Content="Модель" Style="{StaticResource TabStyle}" IsChecked="{Binding IsModelTabSelected}"
                                         GroupName="SettingsTabs"/>
                            <RadioButton Content="Уведомления" Style="{StaticResource TabStyle}" IsChecked="{Binding IsNotificationsTabSelected}"
                                         GroupName="SettingsTabs"/>
                        </StackPanel>
                    </Border>
                    <Border Grid.Column="1" Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="20"
                            Margin="10,0,0,0" Effect="{StaticResource DropShadowEffect}">
                        <Grid>
                            <!-- Chat Settings -->
                            <StackPanel Visibility="{Binding IsChatTabSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Тема интерфейса" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <ComboBox SelectedIndex="{Binding ChatSettings.ThemeIndex}" Margin="0,0,0,10">
                                    <ComboBoxItem Content="Светлая"/>
                                    <ComboBoxItem Content="Тёмная"/>
                                    <ComboBoxItem Content="Системная"/>
                                </ComboBox>
                                <TextBlock Text="Предпросмотр темы" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <Border Background="{Binding ChatSettings.PreviewBackground}" CornerRadius="5" Height="50" Margin="0,0,0,10"/>
                                <TextBlock Text="Имя бота" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <TextBox Style="{StaticResource ModernTextBoxStyle}" Text="{Binding ChatSettings.BotName}"/>
                            </StackPanel>
                            <!-- Diary Settings -->
                            <StackPanel Visibility="{Binding IsDiaryTabSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Стиль заметок по умолчанию" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <ComboBox SelectedIndex="{Binding DiarySettings.DiaryNoteStyleIndex}" Margin="0,0,0,10">
                                    <ComboBoxItem Content="От первого лица"/>
                                    <ComboBoxItem Content="От третьего лица"/>
                                </ComboBox>
                            </StackPanel>
                            <!-- Profile Settings -->
                            <StackPanel Visibility="{Binding IsProfileTabSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Имя пользователя" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <TextBox Style="{StaticResource ModernTextBoxStyle}" Text="{Binding ProfileSettings.Username}" Margin="0,0,0,10"/>
                                <TextBlock Text="Аватар" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <Button Content="Загрузить аватар" Style="{StaticResource ModernButtonStyle}" Width="150"
                                        Command="{Binding ProfileSettings.UploadAvatarCommand}"/>
                            </StackPanel>
                            <!-- Model Settings -->
                            <StackPanel Visibility="{Binding IsModelTabSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Стиль общения" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <ComboBox SelectedIndex="{Binding ModelSettings.CommunicationStyleIndex}" Margin="0,0,0,10">
                                    <ComboBoxItem Content="Эмпатичный"/>
                                    <ComboBoxItem Content="Нейтральный"/>
                                    <ComboBoxItem Content="Мотивационный"/>
                                </ComboBox>
                                <TextBlock Text="Уровень эмпатии" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <Slider Minimum="0" Maximum="2" Value="{Binding ModelSettings.EmpathyLevel}" TickFrequency="1" IsSnapToTickEnabled="True" Margin="0,0,0,10"/>
                                <TextBlock Text="Тон" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <ComboBox SelectedIndex="{Binding ModelSettings.ToneIndex}" Margin="0,0,0,10">
                                    <ComboBoxItem Content="Дружелюбный"/>
                                    <ComboBoxItem Content="Формальный"/>
                                    <ComboBoxItem Content="Игривый"/>
                                </ComboBox>
                                <Button Content="Расширенные настройки модели" Style="{StaticResource ModernButtonStyle}" Width="200"
                                        Command="{Binding ModelSettings.ShowAdvancedModelSettingsCommand}"/>
                            </StackPanel>
                            <!-- Notifications Settings -->
                            <StackPanel Visibility="{Binding IsNotificationsTabSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <CheckBox Content="Включить уведомления" IsChecked="{Binding NotificationSettings.NotificationsEnabled}" Margin="0,0,0,10"/>
                                <TextBlock Text="Звук уведомления" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <ComboBox SelectedIndex="{Binding NotificationSettings.NotificationSoundIndex}" Margin="0,0,0,10">
                                    <ComboBoxItem Content="Стандартный"/>
                                    <ComboBoxItem Content="Мелодия 1"/>
                                    <ComboBoxItem Content="Мелодия 2"/>
                                </ComboBox>
                                <TextBlock Text="Громкость" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <Slider Minimum="0" Maximum="100" Value="{Binding NotificationSettings.NotificationVolume}" TickFrequency="10" IsSnapToTickEnabled="True" Margin="0,0,0,10"/>
                                <TextBlock Text="Напоминания" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <ComboBox SelectedIndex="{Binding NotificationSettings.ReminderFrequency}" Margin="0,0,0,10">
                                    <ComboBoxItem Content="Отключены"/>
                                    <ComboBoxItem Content="Ежедневно"/>
                                    <ComboBoxItem Content="Еженедельно"/>
                                </ComboBox>
                                <TextBlock Text="Время напоминания" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                                <materialDesign:TimePicker SelectedTime="{Binding NotificationSettings.ReminderTime}" Margin="0,0,0,10"/>
                                <Button Content="Тест уведомления" Style="{StaticResource ModernButtonStyle}" Width="150"
                                        Command="{Binding NotificationSettings.TestNotificationCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,20,0,0">
                    <Button Content="Сохранить изменения" Style="{StaticResource ModernButtonStyle}" Margin="0,0,10,0"
                            Command="{Binding SaveSettingsCommand}"/>
                    <Button Content="Сбросить настройки" Style="{StaticResource ModernButtonStyle}" Margin="0,0,10,0"
                            Command="{Binding ResetSettingsCommand}"/>
                    <Button Content="Резервное копирование" Style="{StaticResource ModernButtonStyle}" Margin="0,0,10,0"
                            Command="{Binding BackupSettingsCommand}"/>
                    <Button Content="О приложении" Style="{StaticResource ModernButtonStyle}"
                            Command="{Binding ShowAboutCommand}"/>
                </StackPanel>
            </Grid>
        </Border>
        <!-- Модальное окно для сохранения -->
        <Border Background="{StaticResource ModalOverlayBrush}"
                Visibility="{Binding IsSaveSettingsModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="20"
                    Width="300" Height="150" VerticalAlignment="Center" HorizontalAlignment="Center"
                    Effect="{StaticResource DropShadowEffect}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Сохранить настройки? Это повлияет на стиль приложения." TextWrapping="Wrap"
                               Style="{StaticResource BaseTextStyle}" FontSize="14"/>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                        <Button Content="Отмена" Style="{StaticResource ModernButtonStyle}" Margin="0,0,10,0"
                                Command="{Binding CancelSaveSettingsCommand}"/>
                        <Button Content="Сохранить" Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding ConfirmSaveSettingsCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Border>
        <!-- Модальное окно для сброса -->
        <Border Background="{StaticResource ModalOverlayBrush}"
                Visibility="{Binding IsResetSettingsModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="20"
                    Width="300" Height="150" VerticalAlignment="Center" HorizontalAlignment="Center"
                    Effect="{StaticResource DropShadowEffect}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Сбросить все настройки? Это действие нельзя отменить." TextWrapping="Wrap"
                               Style="{StaticResource BaseTextStyle}" FontSize="14"/>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                        <Button Content="Отмена" Style="{StaticResource ModernButtonStyle}" Margin="0,0,10,0"
                                Command="{Binding CancelResetSettingsCommand}"/>
                        <Button Content="Сбросить" Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding ConfirmResetSettingsCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Border>
        <!-- Модальное окно "О приложении" -->
        <Border Background="{StaticResource ModalOverlayBrush}"
                Visibility="{Binding IsAboutModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="20"
                    Width="300" Height="150" VerticalAlignment="Center" HorizontalAlignment="Center"
                    Effect="{StaticResource DropShadowEffect}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="EmotionAid, Версия 1.0, 2025" TextWrapping="Wrap"
                               Style="{StaticResource BaseTextStyle}" FontSize="14"/>
                    <Button Grid.Row="1" Content="Закрыть" Style="{StaticResource ModernButtonStyle}"
                            HorizontalAlignment="Right" Margin="0,10,0,0" Command="{Binding CloseAboutCommand}"/>
                </Grid>
            </Border>
        </Border>
        <!-- Модальное окно для расширенных настроек модели -->
        <Border Background="{StaticResource ModalOverlayBrush}"
                Visibility="{Binding ModelSettings.IsAdvancedModelSettingsModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="20"
                    Width="400" Height="500" VerticalAlignment="Center" HorizontalAlignment="Center"
                    Effect="{StaticResource DropShadowEffect}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Расширенные настройки модели" FontSize="16" FontWeight="SemiBold"
                               Style="{StaticResource BaseTextStyle}" Margin="0,0,0,10"/>
                    <StackPanel Grid.Row="1">
                        <TextBlock Text="Режим запуска" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <RadioButton Content="Локально" IsChecked="{Binding ModelSettings.IsLocalModel}" Margin="0,0,10,0"/>
                            <RadioButton Content="На сервере" IsChecked="{Binding ModelSettings.IsServerModel}"/>
                        </StackPanel>
                        <TextBlock Text="Пользовательский промт" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                        <TextBox Style="{StaticResource ModernTextBoxStyle}" AcceptsReturn="True" TextWrapping="Wrap" Height="100"
                                 Text="{Binding ModelSettings.CustomPrompt}" Margin="0,0,0,10"/>
                        <TextBlock Text="Температура" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                        <Slider Minimum="0" Maximum="1" Value="{Binding ModelSettings.Temperature}" TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="0,0,0,10"/>
                        <TextBlock Text="Top-p" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                        <Slider Minimum="0.1" Maximum="1" Value="{Binding ModelSettings.TopP}" TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="0,0,0,10"/>
                        <TextBlock Text="Максимальная длина ответа (токены)" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,5"/>
                        <TextBox Style="{StaticResource ModernTextBoxStyle}" Text="{Binding ModelSettings.MaxResponseLength}" Margin="0,0,0,10"/>
                    </StackPanel>
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                        <Button Content="Отмена" Style="{StaticResource ModernButtonStyle}" Margin="0,0,10,0"
                                Command="{Binding ModelSettings.CancelAdvancedModelSettingsCommand}"/>
                        <Button Content="Сохранить" Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding ModelSettings.SaveAdvancedModelSettingsCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Border>
        <!-- Модальное окно для резервного копирования -->
        <Border Background="{StaticResource ModalOverlayBrush}"
                Visibility="{Binding IsBackupModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="20"
                    Width="300" Height="150" VerticalAlignment="Center" HorizontalAlignment="Center"
                    Effect="{StaticResource DropShadowEffect}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Сохранить настройки и данные в файл?" TextWrapping="Wrap"
                               Style="{StaticResource BaseTextStyle}" FontSize="14"/>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                        <Button Content="Отмена" Style="{StaticResource ModernButtonStyle}" Margin="0,0,10,0"
                                Command="{Binding CancelBackupCommand}"/>
                        <Button Content="Сохранить" Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding SaveBackupCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Border>
    </Grid>
</Page>