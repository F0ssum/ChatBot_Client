<Page x:Class="ChatBotClient.Features.Diary.Views.DiaryPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:oxy="http://oxyplot.org/wpf"
      Background="{StaticResource BackgroundBrush}">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="300"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель: Теги и фильтры -->
        <Border Grid.Column="0" Background="{StaticResource PaperHoverBrush}" Padding="16">
            <StackPanel>
                <TextBlock Text="Теги" FontSize="16" FontWeight="SemiBold" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,10"/>
                <ItemsControl ItemsSource="{Binding Tags}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <ToggleButton Content="{Binding}" Style="{StaticResource ModernToggleButtonStyle}" Margin="0,0,0,5"
                                          Command="{Binding DataContext.SelectTagCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                          CommandParameter="{Binding}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <TextBox Text="{Binding NewTag, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource ModernTextBoxWithHintStyle}" Margin="0,10,0,0"/>
                <Button Content="Добавить тег" Style="{StaticResource ModernButtonStyle}" Command="{Binding AddTagCommand}" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <!-- Центр: Список заметок -->
        <Grid Grid.Column="1" Margin="16,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <!-- Поиск и сортировка -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <TextBox Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource ModernTextBoxStyle}" Width="200" materialDesign:HintAssist.Hint="Поиск..."/>
                <ComboBox SelectedIndex="{Binding SortMode}" Width="120" Margin="10,0,0,0">
                    <ComboBoxItem Content="По дате"/>
                    <ComboBoxItem Content="По тегу"/>
                </ComboBox>
                <Button Content="{materialDesign:PackIcon Kind=Filter}" Style="{StaticResource IconButtonStyle}" Command="{Binding ShowFiltersCommand}" Margin="10,0,0,0"/>
            </StackPanel>
            <!-- Список заметок -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Entries}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{StaticResource PaperHoverBrush}" CornerRadius="12" Padding="12" Margin="0,0,0,12" Effect="{StaticResource DropShadowEffect}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Emoji}" FontSize="18" Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding Title}" FontWeight="SemiBold" FontSize="16" Style="{StaticResource BaseTextStyle}"/>
                                        <TextBlock Text="{Binding Date, StringFormat='dd.MM.yyyy'}" FontSize="12" Foreground="{StaticResource DividerBrush}" Margin="10,0,0,0"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding Content}" Style="{StaticResource BaseTextStyle}" TextWrapping="Wrap" MaxHeight="60" Foreground="{StaticResource SecondaryBrush}"/>
                                    <WrapPanel>
                                        <TextBlock Text="{Binding Tags, Converter={StaticResource ListToStringConverter}}" Style="{StaticResource BaseTextStyle}" FontSize="12" Foreground="{StaticResource SecondaryBrush}"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            <!-- Плавающая кнопка создания заметки -->
            <Button Content="{materialDesign:PackIcon Kind=Plus}" Style="{StaticResource IconButtonStyle}" Width="56" Height="56"
                    VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,24,24"
                    Command="{Binding CreateNoteCommand}" />
        </Grid>

        <!-- Правая панель: График и быстрые действия -->
        <Border Grid.Column="2" Background="{StaticResource PaperHoverBrush}" Padding="16">
            <StackPanel>
                <TextBlock Text="График настроения" FontSize="16" FontWeight="SemiBold" Style="{StaticResource BaseTextStyle}" Margin="0,0,0,10"/>
                <oxy:PlotView Model="{Binding MoodChartModel}" Height="180" Margin="0,0,0,16"/>
                <Button Content="Быстрая заметка" Style="{StaticResource ModernButtonStyle}" Command="{Binding CreateQuickNoteCommand}" Margin="0,0,0,10"/>
                <Button Content="Архивировать" Style="{StaticResource ModernButtonStyle}" Command="{Binding ArchiveNotesCommand}" Margin="0,0,0,10"/>
                <Button Content="Экспортировать" Style="{StaticResource ModernButtonStyle}" Command="{Binding ExportNotesCommand}"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>